<!DOCTYPE html>
<html class="nojs" lang="en-us" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Esri Web AppBuilder 2.4, Empty Basemap Gallery – Node Dangles</title>
<meta name="description" content="I recently downloaded Web AppBuilder 2.4, Developer&amp;amp;rsquo;s Edition and built a quick &amp;amp;amp; dirty app. For some reason, it worked fine in Web AppBuilder but once I …">
<meta name="created" content="2017-04-10T20:08:37-0500">
<meta name="modified" content="2017-04-10T20:08:37-0500">
<meta name="author" content="Matt">

<meta property="og:site_name" content="Node Dangles">
<meta property="og:title" content="Esri Web AppBuilder 2.4, Empty Basemap Gallery">
<meta property="og:url" content="https://maprantala.com/2017/04/10/esri-web-appbuilder-2.4-empty-basemap-gallery/">
<meta property="og:type" content="article">

<meta name="generator" content="Hugo 0.80.0" />
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<link rel="canonical" href="https://maprantala.com/2017/04/10/esri-web-appbuilder-2.4-empty-basemap-gallery/">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<link rel="stylesheet" href="/css/styles.159e5347492c734a666a2678db9a478c339b9ad376372e062cd19572540448a1.css">
<link rel="stylesheet" href="/css/print.27fc184f8670f41a2690985390779e7b20335a8fadff8fa015cf9417ffe50c36.css" media="print">

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "headline": "Esri Web AppBuilder 2.4, Empty Basemap Gallery",
    "datePublished": "2017-04-10T20:08:37-05:00",
    "dateModified": "2017-04-10T20:08:37-05:00",
    "url" : "https://maprantala.com/2017/04/10/esri-web-appbuilder-2.4-empty-basemap-gallery/",
    "description": "I recently downloaded Web AppBuilder 2.4, Developer\u0026amp;rsquo;s Edition and built a quick \u0026amp;amp; dirty app. For some reason, it worked fine in Web AppBuilder but once I …",
    "keywords": ["appendDeployVersion","Basemap Gallery","Bugs","deployversion","env.js","JavaScript","Web Appbuilder"],
    "author": {
      "@type": "Person",
      "name": "Matt"
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://maprantala.com"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Node Dangles",
      "url": "https://maprantala.com"
    }
  }
</script>

<script src="/js/script-early.min.a8d899ac88f2a778985767b86ce681945e3fa2069c3c9efd17e5e5b594d3ba1f.js"></script>
<script defer src="/js/lib/umbrella.min.e2bb46ea729a2df1793c868bff01df1f4a4889a5c8c97a2f176aebb9c514b3e6.js"></script>
<script defer src="/js/script.min.f7f56769569fdf7a80d073b6775c6cd9ed8ae528864cd3f2aa1c8c3fe73f87ea.js"></script>


</head>

<body class="single-page">
<div class="page layout__page layout__sidebar-second">
<header class="header layout__header">
<a href="/" title="Home" rel="home" class="header__logo"><img src="/images/logo.png" alt="Home" class="header__logo-image"></a>
<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>Node Dangles</span></a>
</h1>
<div class="region header__region">
</div>
</header>

<nav class="main-menu layout__navigation">
<h2 class="visually-hidden">Main menu</h2>
<ul class="navbar">
<li><a href="/">Home</a></li>
<li><a href="/posts/" class="active" aria-current="page">Posts</a></li>
</ul>
</nav>


<main class="main layout__main">
<article class="section-posts single-view">
<header>
<h1 class="title ">Esri Web AppBuilder 2.4, Empty Basemap Gallery</h1>
<div class="tags">
Tags:
<ul>
<li><a href="/tags/appenddeployversion">appendDeployVersion</a></li>
<li><a href="/tags/basemap-gallery">Basemap Gallery</a></li>
<li><a href="/tags/bugs">Bugs</a></li>
<li><a href="/tags/deployversion">deployversion</a></li>
<li><a href="/tags/env.js">env.js</a></li>
<li><a href="/tags/javascript">JavaScript</a></li>
<li><a href="/tags/web-appbuilder">Web Appbuilder</a></li>
</ul>
</div>
</header>
<div class="content">
<p>I recently downloaded Web AppBuilder 2.4, Developer&rsquo;s Edition and built a quick &amp; dirty app. For some reason, it worked fine in Web AppBuilder but once I deployed it, no basemaps would show in the B<a href="http://doc.arcgis.com/en/web-appbuilder/create-apps/widget-basemap.htm">aseman Gallery widget</a>, it would just spin, spin, spin.</p>
<p><a href="https://i2.wp.com/maprantala.com/wp-content/uploads/2017/04/BasemapGallery.png"><!-- raw HTML omitted --></a></p>
<p>Digging around, I found some <a href="https://geonet.esri.com/thread/118906">old posts</a> where users were experiencing similar problems but none of the solution resulted in a great solution. I was able to get it to work by listing the basemaps individually in the config_BasemapGallery.json file but I that was more of a work-around. Notice in the thumbnailUrl, I have to put the full path to the thumbnails. Note that for brevity&rsquo;s sake, I&rsquo;m only showing one of the basemaps in this sample.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Eventually, I started comparing the requests generated by the version in the development version and the one in production and tracked the problem down to this POST request in production, which was returning a 400 Bad Request error:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>To this one in dev:</p>
<!-- raw HTML omitted -->
<p>I stripped off the &lsquo;&amp;wab_dv=2.4&rsquo; parameter from the production request and Boom! it worked. So I now knew what was causing the problem. Just had to figure out why it was occurring. I had actually already seen part of the answer while digging around in <strong>env.js</strong> while looking for a way to test my changes without having to clear my cache or remember to use an Incognito session. On line 81 of <strong>env.js</strong>, there is this variable, <strong>deployVersion</strong> which is set to 2.4.</p>
<p><a href="https://i2.wp.com/maprantala.com/wp-content/uploads/2017/04/deployVersion.png"><!-- raw HTML omitted --></a><br>
I had recently worked on a solution that involved appending a time stamp onto scripts we were loading so I was familiar with what is going on–the code was appending a version onto the call so that if you change the <strong>deployVersion</strong>, the browser would load a new version of the code. The <strong>appendDeployVersion</strong> function on line 307 of <strong>env.js</strong> was doing the append. Notice the <strong>if</strong> statement on line 312, it checks for &lsquo;?&rsquo; in the url. If it finds one, it appends &lsquo;**&amp;<strong>wab_dv=&rsquo; and the version, otherwise it appends &lsquo;</strong>?**wab_dv=&rsquo; and the version–the difference being the &lsquo;&amp;&rsquo; vs &lsquo;?&rsquo;. A question mark is used before the first parameter in an URL, each additional parameter is separated by a ampersand (&amp;) so that logic makes sense.</p>
<p><a href="https://i2.wp.com/maprantala.com/wp-content/uploads/2017/04/IfStatement.png"><!-- raw HTML omitted --></a></p>
<p>However, the monkey wrench is that I&rsquo;m using a proxy, so my URL has a question mark related to the proxy:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>So the code was dutifully appending an ampersand and the version parameter &lsquo;&amp;wab_dv=2.4&rsquo; to my URL so the proxy would be requesting:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>when it should have been requesting:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Once I had determined the problem (99% of the battle), I was able to quickly put in a patch that works for my instance. This patch isn&rsquo;t a great one that Esri should use but it solves it in my case. I just added logic so that it would ignore proxy-related question marks:</p>
<p><a href="https://i0.wp.com/maprantala.com/wp-content/uploads/2017/04/solution.png"><!-- raw HTML omitted --></a></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>And voila! my Web AppBuilder now had all the basemaps options a mapineer could hope for:<br>
<a href="https://i0.wp.com/maprantala.com/wp-content/uploads/2017/04/BaemapsAplenty.png"><!-- raw HTML omitted --></a></p>


</div>
</article>
</main>


<footer class="footer layout__footer">
<p><span>© Node Dangles</span></p>


</footer>

</div>
</body>
</html>
